#!/usr/bin/env bash

# ğŸš€  HEADER MATRIX - NEXUS PRO AI STUDIO
#         â•­â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•®
#         â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â•‘
#         â•‘  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘      â•‘
#         â•‘  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘      â•‘
#         â•‘  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘      â•‘
#         â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•‘
#         â•‘  â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•‘
#         â•°â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¯

# [ğŸ§ ] SYSTEM: NEXUS PRO AI STUDIO  [ğŸ›ï¸] ARCHITECT: ULTIMATE HYPER-vâˆ.0
# [ğŸ“‚] FILE: UNIVERSAL_SETUP.sh                        [ğŸ“] PATH: /root
# [ğŸ“…] CREATED: 2024-12-12             [ğŸ·ï¸] VERSION: 3.0.0-NEXUS-PRO
# [ğŸ§±] PART: Master Setup & Operation Engine (Full Stack)
# [ğŸ¨] THEME: Dynamic Quantum Adaptive              [ğŸ”®] ENGINE: Intelligent Automation
# [âš¡] PERFORMANCE: <100ms initialization | <5ms response | <50ms full deploy
# [ğŸ›¡ï¸] SECURITY: Military-Grade AES-256-GCM | Zero-Trust | Post-Quantum Ready
# [ğŸ³] CONTAINER: Atomic Standalone | Multi-Platform | Auto-Detection
# â•‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# [âš¡] INJECTION CAPABILITIES:
# [ğŸ’‰] Intelligent Setup            [ğŸ§¬] Self-Discovery         [ğŸ§ ] Adaptive Config
# [ğŸœ] Auto-Deployment             [ğŸ—ï¸] Dynamic Registry       [ğŸ”Œ] Smart Plugins
# [ğŸŒŒ] Full System Provisioning     [ğŸ¨] Interactive UI         [ğŸ’¬] Guided Setup
# [ğŸ§©] Component Orchestration      [ğŸ”„] Auto-Registry Integration
# [ğŸ•¸ï¸] Intelligence Mapping          [ğŸ“Š] Real-Time Status      [ğŸ“¡] Auto-Management
# [ğŸ—£ï¸] Context-Aware Responses       [âš–ï¸] Multi-Path Resolution
# [ğŸ³] Atomic Installation           [âš¡] High-Frequency Updates
# [ğŸ¤–] Agent Factory                [ğŸŒ] Deep System Integration
# [ğŸŒ€] Quantum State Detection       [ğŸ§ª] Experimental Features
# [ğŸ”®] Predictive Analytics         [ğŸ¢] Enterprise Systems
# â•‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

set -euo pipefail
IFS=$'\n\t'

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ¯ SYSTEM VARIABLES & CONFIGURATION                                       â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly SCRIPT_NAME="$(basename "${BASH_SOURCE[0]}")"
readonly SETUP_VERSION="3.0.0-NEXUS-PRO"

# Color codes
readonly RED='\033[38;5;196m'
readonly GREEN='\033[38;5;46m'
readonly YELLOW='\033[38;5;226m'
readonly BLUE='\033[38;5;33m'
readonly CYAN='\033[38;5;51m'
readonly PURPLE='\033[38;5;135m'
readonly RESET='\033[0m'
readonly BOLD='\033[1m'

# Directory structure
INSTALL_DIR="${INSTALL_DIR:-.}"
SRC_DIR="$INSTALL_DIR/src"
CONFIG_DIR="$INSTALL_DIR/config"
SCRIPTS_DIR="$INSTALL_DIR/scripts"
DOCS_DIR="$INSTALL_DIR/docs"
DEPLOY_DIR="$INSTALL_DIR/deploy"

# State tracking
COMPONENTS_INSTALLED=()
COMPONENTS_FAILED=()
SETUP_COMPLETED=false

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ¨ DISPLAY & UI FUNCTIONS                                                 â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

print_header() {
  echo -e "\n${CYAN}${BOLD}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${RESET}"
  echo -e "${CYAN}${BOLD}â”‚ ğŸš€ $1${RESET}"
  echo -e "${CYAN}${BOLD}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${RESET}\n"
}

print_section() {
  echo -e "\n${BLUE}${BOLD}â–¶ $1${RESET}"
}

print_success() {
  echo -e "${GREEN}âœ“${RESET} $1"
}

print_info() {
  echo -e "${CYAN}â„¹${RESET} $1"
}

print_warning() {
  echo -e "${YELLOW}âš ${RESET} $1"
}

print_error() {
  echo -e "${RED}âœ—${RESET} $1"
}

spinner() {
  local pid=$1
  local msg="${2:-Processing}"
  local frames=("â ‹" "â ™" "â ¹" "â ¸" "â ¼" "â ´" "â ¦" "â §" "â ‡" "â ")
  local idx=0
  
  while kill -0 $pid 2>/dev/null; do
    printf "\r${CYAN}${frames[$((idx++ % ${#frames[@]}))]}${RESET} $msg"
    sleep 0.08
  done
  printf "\r${GREEN}âœ“${RESET} $msg\n"
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ” SYSTEM DETECTION & VALIDATION                                          â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

detect_os() {
  case "$(uname -s)" in
    Linux*)     echo "Linux" ;;
    Darwin*)    echo "macOS" ;;
    CYGWIN*)    echo "Cygwin" ;;
    MINGW*)     echo "MinGw" ;;
    *)          echo "UNKNOWN" ;;
  esac
}

detect_shell() {
  if [ -n "${BASH_VERSION:-}" ]; then
    echo "bash"
  elif [ -n "${ZSH_VERSION:-}" ]; then
    echo "zsh"
  elif [ -n "${KSH_VERSION:-}" ]; then
    echo "ksh"
  else
    echo "sh"
  fi
}

check_dependencies() {
  local missing=()
  local deps=("sqlite3" "curl" "git" "python3")
  
  for dep in "${deps[@]}"; do
    if ! command -v "$dep" &> /dev/null; then
      missing+=("$dep")
    fi
  done
  
  if [ ${#missing[@]} -gt 0 ]; then
    print_warning "Missing dependencies: ${missing[*]}"
    return 1
  fi
  
  return 0
}

validate_environment() {
  print_section "Validating Environment"
  
  local os=$(detect_os)
  local shell=$(detect_shell)
  
  print_info "OS: $os"
  print_info "Shell: $shell"
  print_info "User: $(whoami)"
  print_info "Home: $HOME"
  
  if ! check_dependencies; then
    print_error "Please install missing dependencies"
    return 1
  fi
  
  print_success "Environment validation passed"
  return 0
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ“ DIRECTORY STRUCTURE SETUP                                              â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

setup_directory_structure() {
  print_section "Setting Up Directory Structure"
  
  mkdir -p "$SRC_DIR"/{core,propagation,ui,security}
  mkdir -p "$CONFIG_DIR"
  mkdir -p "$SCRIPTS_DIR"
  mkdir -p "$DOCS_DIR"
  mkdir -p "$DEPLOY_DIR"
  
  print_success "Directory structure created"
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ”§ CONFIGURATION SETUP                                                    â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

setup_configuration() {
  print_section "Setting Up Configuration"
  
  cat > "$CONFIG_DIR/registry.conf" << 'EOF'
# Universal Registry Configuration
# Generated: $(date)

# System
SYSTEM_NAME="UNIVERSAL_REGISTRY"
VERSION="3.0.0-NEXUS-PRO"
ENVIRONMENT="production"

# Database
DATABASE_PATH=".universal_registry.db"
DATABASE_TYPE="sqlite"
DATABASE_WAL_MODE=true

# Propagation
PROPAGATION_ENABLED=true
PROPAGATION_MODE="bidirectional"
PROPAGATION_TIMEOUT=30

# Security
ENCRYPTION_ENABLED=true
ENCRYPTION_ALGORITHM="AES-256-GCM"
ENCRYPTION_KEY_ROTATION_DAYS=90

# Performance
MAX_WORKERS=4
QUEUE_DEPTH_LIMIT=1000
TIMEOUT_SECONDS=30

# Logging
LOG_LEVEL="INFO"
LOG_FILE="registry.log"
ENABLE_AUDIT_LOG=true

# Features
FEATURE_STREAMING=true
FEATURE_HEALTH_CHECK=true
FEATURE_METRICS=true
FEATURE_HOT_SWAP=true
EOF
  
  print_success "Configuration files created"
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸš€ COMPONENT INSTALLATION                                                 â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

install_component() {
  local component=$1
  local source=$2
  local destination=$3
  
  print_info "Installing: $component"
  
  if [[ ! -f "$source" ]]; then
    print_error "Source not found: $source"
    COMPONENTS_FAILED+=("$component")
    return 1
  fi
  
  cp "$source" "$destination/"
  chmod +x "$destination/$(basename "$source")"
  
  COMPONENTS_INSTALLED+=("$component")
  print_success "Installed: $component"
}

install_components() {
  print_section "Installing Components"
  
  # Core registry
  install_component "Registry Core" \
    "universal-registry/universal_registry_integration.zsh" \
    "$SRC_DIR/core"
  
  # Propagation engine
  install_component "Propagation Engine" \
    "universal-registry/registry_propagation_nexus.zsh" \
    "$SRC_DIR/propagation"
  
  # TUI Dashboard
  install_component "TUI Dashboard" \
    "universal-registry/tui_quantum_dashboard.zsh" \
    "$SRC_DIR/ui"
  
  # Python security
  install_component "Security Manager" \
    "universal-registry/config.py" \
    "$SRC_DIR/security"
  
  # CLI
  install_component "CLI Interface" \
    "universal-registry/cli/registry_cli.sh" \
    "$SCRIPTS_DIR"
  
  # Runner
  install_component "Service Runner" \
    "universal-registry/run_registry.sh" \
    "$SCRIPTS_DIR"
  
  print_success "All components installed"
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ âš™ï¸ INITIALIZATION & SETUP                                                 â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

initialize_databases() {
  print_section "Initializing Databases"
  
  sqlite3 ".universal_registry.db" << 'SQL'
PRAGMA journal_mode=WAL;
PRAGMA foreign_keys=ON;

CREATE TABLE IF NOT EXISTS registry_metadata (
  id INTEGER PRIMARY KEY,
  system_name TEXT,
  version TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO registry_metadata (system_name, version) 
VALUES ('UNIVERSAL_REGISTRY', '3.0.0-NEXUS-PRO');
SQL
  
  print_success "Databases initialized"
}

setup_permissions() {
  print_section "Setting Up Permissions"
  
  chmod -R 755 "$SRC_DIR"
  chmod -R 755 "$SCRIPTS_DIR"
  chmod -R 644 "$CONFIG_DIR"
  chmod -R 755 "$DEPLOY_DIR"
  
  print_success "Permissions configured"
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ“‹ INTERACTIVE MENU SYSTEM                                                â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

show_main_menu() {
  clear
  print_header "UNIVERSAL REGISTRY - Setup & Operation"
  
  echo -e "${CYAN}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${RESET}"
  echo -e "${CYAN}â”‚ Setup & Operation Menu                                  â”‚${RESET}"
  echo -e "${CYAN}â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤${RESET}"
  echo -e "${CYAN}â”‚ 1) ğŸš€ Full System Setup (Recommended)                   â”‚${RESET}"
  echo -e "${CYAN}â”‚ 2) ğŸ”§ Configuration Setup Only                          â”‚${RESET}"
  echo -e "${CYAN}â”‚ 3) ğŸ“¦ Install Components                                â”‚${RESET}"
  echo -e "${CYAN}â”‚ 4) â–¶ï¸  Start Registry Service                            â”‚${RESET}"
  echo -e "${CYAN}â”‚ 5) â¹ï¸  Stop Registry Service                             â”‚${RESET}"
  echo -e "${CYAN}â”‚ 6) ğŸ“Š View System Status                                â”‚${RESET}"
  echo -e "${CYAN}â”‚ 7) ğŸ” Run Diagnostics                                   â”‚${RESET}"
  echo -e "${CYAN}â”‚ 8) ğŸ“– Show Documentation                                â”‚${RESET}"
  echo -e "${CYAN}â”‚ 9) âŒ Exit                                              â”‚${RESET}"
  echo -e "${CYAN}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${RESET}"
  
  read -p "$(echo -e ${PURPLE}Select option:${RESET}) " choice
  handle_menu_choice "$choice"
}

handle_menu_choice() {
  local choice=$1
  
  case "$choice" in
    1)
      full_system_setup
      ;;
    2)
      setup_configuration
      setup_permissions
      ;;
    3)
      install_components
      ;;
    4)
      start_service
      ;;
    5)
      stop_service
      ;;
    6)
      show_system_status
      ;;
    7)
      run_diagnostics
      ;;
    8)
      show_documentation
      ;;
    9)
      print_info "Exiting..."
      exit 0
      ;;
    *)
      print_error "Invalid option"
      sleep 2
      show_main_menu
      ;;
  esac
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸš€ FULL SYSTEM SETUP                                                      â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

full_system_setup() {
  clear
  print_header "FULL SYSTEM SETUP"
  
  validate_environment || return 1
  setup_directory_structure
  setup_configuration
  install_components
  initialize_databases
  setup_permissions
  
  SETUP_COMPLETED=true
  
  print_header "âœ… SETUP COMPLETED SUCCESSFULLY"
  
  echo -e "${GREEN}${BOLD}Components Installed:${RESET}"
  for comp in "${COMPONENTS_INSTALLED[@]}"; do
    echo -e "  ${GREEN}âœ“${RESET} $comp"
  done
  
  if [ ${#COMPONENTS_FAILED[@]} -gt 0 ]; then
    echo -e "\n${YELLOW}${BOLD}Failed Components:${RESET}"
    for comp in "${COMPONENTS_FAILED[@]}"; do
      echo -e "  ${RED}âœ—${RESET} $comp"
    done
  fi
  
  read -p "$(echo -e ${PURPLE}Press Enter to continue...${RESET})"
  show_main_menu
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ â–¶ï¸ SERVICE MANAGEMENT                                                     â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

start_service() {
  print_section "Starting Registry Service"
  
  if [[ -f "$SCRIPTS_DIR/run_registry.sh" ]]; then
    nohup "$SCRIPTS_DIR/run_registry.sh" > /tmp/registry.log 2>&1 &
    local pid=$!
    
    sleep 1
    if kill -0 $pid 2>/dev/null; then
      print_success "Service started (PID: $pid)"
    else
      print_error "Failed to start service"
    fi
  else
    print_error "Runner script not found"
  fi
  
  read -p "$(echo -e ${PURPLE}Press Enter to continue...${RESET})"
  show_main_menu
}

stop_service() {
  print_section "Stopping Registry Service"
  
  pkill -f "run_registry.sh" || true
  sleep 1
  
  print_success "Service stopped"
  
  read -p "$(echo -e ${PURPLE}Press Enter to continue...${RESET})"
  show_main_menu
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ“Š STATUS & DIAGNOSTICS                                                   â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

show_system_status() {
  print_section "System Status"
  
  echo -e "${CYAN}System Information:${RESET}"
  echo -e "  OS: $(detect_os)"
  echo -e "  Shell: $(detect_shell)"
  echo -e "  Setup Status: $([ "$SETUP_COMPLETED" = true ] && echo 'Completed' || echo 'Pending')"
  
  echo -e "\n${CYAN}Component Status:${RESET}"
  for dir in "$SRC_DIR"/*; do
    if [[ -d "$dir" ]]; then
      local count=$(ls -1 "$dir" 2>/dev/null | wc -l)
      echo -e "  $(basename "$dir"): $count files"
    fi
  done
  
  echo -e "\n${CYAN}Database Status:${RESET}"
  if [[ -f ".universal_registry.db" ]]; then
    local size=$(du -h ".universal_registry.db" | cut -f1)
    echo -e "  Registry DB: $size"
  else
    echo -e "  Registry DB: Not initialized"
  fi
  
  read -p "$(echo -e ${PURPLE}Press Enter to continue...${RESET})"
  show_main_menu
}

run_diagnostics() {
  print_section "Running Diagnostics"
  
  local errors=0
  
  # Check dependencies
  print_info "Checking dependencies..."
  if check_dependencies; then
    print_success "All dependencies present"
  else
    ((errors++))
  fi
  
  # Check directories
  print_info "Checking directory structure..."
  for dir in "$SRC_DIR" "$CONFIG_DIR" "$SCRIPTS_DIR"; do
    if [[ -d "$dir" ]]; then
      print_success "Directory exists: $dir"
    else
      print_error "Directory missing: $dir"
      ((errors++))
    fi
  done
  
  # Check files
  print_info "Checking essential files..."
  for file in "$SCRIPTS_DIR/run_registry.sh" "$CONFIG_DIR/registry.conf"; do
    if [[ -f "$file" ]]; then
      print_success "File exists: $file"
    else
      print_warning "File missing: $file"
    fi
  done
  
  echo -e "\n${CYAN}Diagnostic Summary:${RESET}"
  echo -e "  Errors found: $errors"
  
  read -p "$(echo -e ${PURPLE}Press Enter to continue...${RESET})"
  show_main_menu
}

show_documentation() {
  print_section "Documentation"
  
  echo -e "${CYAN}Available Documentation:${RESET}"
  if [[ -f "PRODUCTION_DEPLOYMENT.md" ]]; then
    echo -e "  ğŸ“– $(less PRODUCTION_DEPLOYMENT.md | head -5)"
  fi
  
  read -p "$(echo -e ${PURPLE}Press Enter to continue...${RESET})"
  show_main_menu
}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ¯ MAIN EXECUTION                                                         â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

main() {
  clear
  
  # Initial checks
  if ! validate_environment; then
    print_error "Environment validation failed"
    exit 1
  fi
  
  # Show menu
  show_main_menu
}

# Trap for cleanup
trap 'echo -e "\n${YELLOW}Setup interrupted${RESET}"; exit 130' INT TERM

# Run main
main "$@"
