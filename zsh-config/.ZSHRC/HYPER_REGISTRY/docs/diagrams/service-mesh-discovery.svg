<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 900" width="1400" height="900">
  <defs>
    <!-- Gradients -->
    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad4" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#a8edea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fed6e3;stop-opacity:1" />
    </linearGradient>
    
    <!-- Filters -->
    <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="3" dy="3" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <!-- Markers -->
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="700" y="40" font-size="32" font-weight="bold" text-anchor="middle" fill="#333">
    Service Mesh Discovery & Health Check Architecture
  </text>
  <text x="700" y="70" font-size="14" text-anchor="middle" fill="#666">
    Real-time service registration, discovery, health monitoring, and intelligent routing
  </text>
  
  <!-- Layer 1: Service Registration -->
  <text x="700" y="120" font-size="16" font-weight="bold" text-anchor="middle" fill="#333">Layer 1: Service Registration</text>
  
  <g id="service1">
    <rect x="80" y="140" width="160" height="100" fill="url(#grad1)" filter="url(#shadow)" rx="6"/>
    <text x="160" y="165" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Registry Core</text>
    <text x="160" y="182" font-size="11" text-anchor="middle" fill="white">Port: 8001</text>
    <text x="160" y="198" font-size="11" text-anchor="middle" fill="white">Health: /health</text>
    <text x="160" y="214" font-size="11" text-anchor="middle" fill="white">Ready: /ready</text>
  </g>
  
  <g id="service2">
    <rect x="300" y="140" width="160" height="100" fill="url(#grad1)" filter="url(#shadow)" rx="6"/>
    <text x="380" y="165" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Plugin Manager</text>
    <text x="380" y="182" font-size="11" text-anchor="middle" fill="white">Port: 8002</text>
    <text x="380" y="198" font-size="11" text-anchor="middle" fill="white">Health: /health</text>
    <text x="380" y="214" font-size="11" text-anchor="middle" fill="white">Ready: /ready</text>
  </g>
  
  <g id="service3">
    <rect x="520" y="140" width="160" height="100" fill="url(#grad1)" filter="url(#shadow)" rx="6"/>
    <text x="600" y="165" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Security Engine</text>
    <text x="600" y="182" font-size="11" text-anchor="middle" fill="white">Port: 8003</text>
    <text x="600" y="198" font-size="11" text-anchor="middle" fill="white">Health: /health</text>
    <text x="600" y="214" font-size="11" text-anchor="middle" fill="white">Ready: /ready</text>
  </g>
  
  <g id="service4">
    <rect x="740" y="140" width="160" height="100" fill="url(#grad1)" filter="url(#shadow)" rx="6"/>
    <text x="820" y="165" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Discovery Service</text>
    <text x="820" y="182" font-size="11" text-anchor="middle" fill="white">Port: 8004</text>
    <text x="820" y="198" font-size="11" text-anchor="middle" fill="white">Health: /health</text>
    <text x="820" y="214" font-size="11" text-anchor="middle" fill="white">Ready: /ready</text>
  </g>
  
  <g id="service5">
    <rect x="960" y="140" width="160" height="100" fill="url(#grad1)" filter="url(#shadow)" rx="6"/>
    <text x="1040" y="165" font-size="13" font-weight="bold" text-anchor="middle" fill="white">AI Ensemble</text>
    <text x="1040" y="182" font-size="11" text-anchor="middle" fill="white">Port: 8005</text>
    <text x="1040" y="198" font-size="11" text-anchor="middle" fill="white">Health: /health</text>
    <text x="1040" y="214" font-size="11" text-anchor="middle" fill="white">Ready: /ready</text>
  </g>
  
  <g id="service6">
    <rect x="1180" y="140" width="160" height="100" fill="url(#grad1)" filter="url(#shadow)" rx="6"/>
    <text x="1260" y="165" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Policy Engine</text>
    <text x="1260" y="182" font-size="11" text-anchor="middle" fill="white">Port: 8006</text>
    <text x="1260" y="198" font-size="11" text-anchor="middle" fill="white">Health: /health</text>
    <text x="1260" y="214" font-size="11" text-anchor="middle" fill="white">Ready: /ready</text>
  </g>
  
  <!-- Layer 2: Service Registry Store -->
  <text x="700" y="300" font-size="16" font-weight="bold" text-anchor="middle" fill="#333">Layer 2: Service Registry & Metadata Store</text>
  
  <g id="registryStore">
    <rect x="200" y="320" width="1000" height="100" fill="url(#grad2)" filter="url(#shadow)" rx="6"/>
    <text x="700" y="350" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Distributed Service Registry (SQLite/PostgreSQL)</text>
    <text x="700" y="372" font-size="11" text-anchor="middle" fill="white">Service Entries: name, version, port, tags, endpoints, capabilities, metadata</text>
    <text x="700" y="390" font-size="11" text-anchor="middle" fill="white">TTL: 30s (auto-refresh) | Consistency: Strong | Replication: 3-way with consensus</text>
    <text x="700" y="408" font-size="11" text-anchor="middle" fill="white">Last Updated: microsecond-precision timestamp | Change Feed: Event log for downstream consumers</text>
  </g>
  
  <!-- Arrows from Services to Registry -->
  <line x1="160" y1="240" x2="400" y2="320" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="380" y1="240" x2="550" y2="320" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="600" y1="240" x2="650" y2="320" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="820" y1="240" x2="750" y2="320" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1040" y1="240" x2="850" y2="320" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1260" y1="240" x2="950" y2="320" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Layer 3: Health Check Engine -->
  <text x="700" y="480" font-size="16" font-weight="bold" text-anchor="middle" fill="#333">Layer 3: Continuous Health Monitoring & Detection</text>
  
  <g id="healthCheck">
    <rect x="100" y="500" width="1200" height="120" fill="url(#grad3)" filter="url(#shadow)" rx="6"/>
    <text x="700" y="525" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Health Check Probes (every 5 seconds)</text>
    <text x="700" y="545" font-size="11" text-anchor="middle" fill="white">Liveness Probe: GET /health → Response time <100ms, status 200-299 = HEALTHY</text>
    <text x="700" y="562" font-size="11" text-anchor="middle" fill="white">Readiness Probe: GET /ready → Dependencies OK, DB connected, cache available = READY</text>
    <text x="700" y="579" font-size="11" text-anchor="middle" fill="white">Timeout: 5 seconds | Consecutive Failures: 3 = UNHEALTHY | Recovery Grace Period: 15s</text>
    <text x="700" y="596" font-size="11" text-anchor="middle" fill="white">Metrics Collected: latency, error rate, memory usage, goroutines, connections | Stored in 60s time-series window</text>
  </g>
  
  <!-- Layer 4: Discovery Client & Routing -->
  <text x="700" y="680" font-size="16" font-weight="bold" text-anchor="middle" fill="#333">Layer 4: Discovery Client & Intelligent Routing</text>
  
  <g id="discoveryClient">
    <rect x="100" y="700" width="550" height="140" fill="url(#grad4)" filter="url(#shadow)" rx="6"/>
    <text x="375" y="725" font-size="13" font-weight="bold" text-anchor="middle" fill="#333">Discovery Client Library</text>
    <text x="375" y="745" font-size="11" text-anchor="middle" fill="#333">• Watch service changes in real-time</text>
    <text x="375" y="760" font-size="11" text-anchor="middle" fill="#333">• Cache service list with 30s TTL</text>
    <text x="375" y="775" font-size="11" text-anchor="middle" fill="#333">• Circuit breaker per service</text>
    <text x="375" y="790" font-size="11" text-anchor="middle" fill="#333">• Automatic retry with exponential backoff</text>
    <text x="375" y="805" font-size="11" text-anchor="middle" fill="#333">• Health-aware load balancing</text>
    <text x="375" y="820" font-size="11" text-anchor="middle" fill="#333">• Canary deployment support</text>
  </g>
  
  <g id="loadBalancer">
    <rect x="750" y="700" width="550" height="140" fill="url(#grad4)" filter="url(#shadow)" rx="6"/>
    <text x="1025" y="725" font-size="13" font-weight="bold" text-anchor="middle" fill="#333">Routing Strategies</text>
    <text x="1025" y="745" font-size="11" text-anchor="middle" fill="#333">• Round-Robin: Default balanced distribution</text>
    <text x="1025" y="760" font-size="11" text-anchor="middle" fill="#333">• Least Connections: Route to least loaded</text>
    <text x="1025" y="775" font-size="11" text-anchor="middle" fill="#333">• Latency-Aware: Prefer fast responders</text>
    <text x="1025" y="790" font-size="11" text-anchor="middle" fill="#333">• Zone-Local: Prefer same availability zone</text>
    <text x="1025" y="805" font-size="11" text-anchor="middle" fill="#333">• Capability-Based: Route to capable services</text>
    <text x="1025" y="820" font-size="11" text-anchor="middle" fill="#333">• Failover Chain: Automatic degradation</text>
  </g>
  
  <!-- Arrows from Registry to Discovery -->
  <line x1="400" y1="420" x2="350" y2="700" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1000" y1="420" x2="1050" y2="700" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
</svg>
